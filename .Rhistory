library("tidyverse")
calls <- read_csv("nyc_rodent_compliants.csv")
df <-
calls %>%
mutate(Date = as.Date(`Created Date`, format = "%m/%d/%Y"),
Year = format(Date, "%y")) %>%
filter(Descriptor == "Rat Sighting",
Year != 22) %>%
select(Year, BBL, Borough) %>%
na.omit() %>%
group_by(BBL, Year, Borough ) %>%
summarize(count = n()) %>%
filter(BBL != 0, Borough > 10000)
lots_year_1 <- df %>% filter(Year == "10") %>% pull(BBL)
lots_year_2 <- df %>% filter(Year == "11") %>% pull(BBL)
number_in_year_1 <- length(lots_year_1)
number_in_year_2 <- length(lots_year_2)
number_in_year_1_and_2 <- sum(lots_year_1 %in% lots_year_2)
number_in_year_1 * number_in_year_2 / number_in_year_1_and_2
50 * number_in_year_1 * number_in_year_2 / number_in_year_1_and_2
capture_recapture <- function(year) {
lots_year_1 <- df %>% filter(Year == year - 1) %>% pull(BBL)
lots_year_2 <- df %>% filter(Year == year) %>% pull(BBL)
number_in_year_1 <- length(lots_year_1)
number_in_year_2 <- length(lots_year_2)
number_in_year_1_and_2 <- sum(lots_year_1 %in% lots_year_2)
50 * number_in_year_1 * number_in_year_2 / number_in_year_1_and_2
}
qplot(x = factor(2011:2021),
weight = sapply(11:21, capture_recapture),
geom = "bar")  +
labs(x = "year",
y = "estimated rat population") +
theme_bw()
library(ggplot2)
ggplot(df, aes(fill= Borough, y = count , x = Year)) +
geom_bar(position = "stack", stat = "identity")
capture_recapture <- function(year) {
lots_year_1 <- df %>% filter(Year == year - 1) %>% pull(BBL)
lots_year_2 <- df %>% filter(Year == year) %>% pull(BBL)
number_in_year_1 <- length(lots_year_1)
number_in_year_2 <- length(lots_year_2)
number_in_year_1_and_2 <- sum(lots_year_1 %in% lots_year_2)
50 * number_in_year_1 * number_in_year_2 / number_in_year_1_and_2
}
View(capture_recapture)
