---
title: "TestAppCapRecap"
author: "Chris"
date: '2022-06-20'
output: html_document
---

```{r}
library("tidyverse")
```

```{r}
calls <- read_csv("nyc_rodent_compliants.csv")
```

```{r}
# df <-
#   calls %>%
#   mutate(Date = as.Date(`Created Date`, format = "%m/%d/%Y"),
#          Month_Year = format(Date, "%m/%y")) %>%
#   filter(Descriptor == "Rat Sighting",
#          Month_Year != 01/22, Month_Year >= 01/14) %>%
#   select( BBL, Borough, `Incident Zip`, Month_Year) %>%
#   na.omit() %>%
#   group_by(BBL, Borough, `Incident Zip`, Month_Year) %>%
#   summarize(count = n()) %>% 
#   filter(BBL != 0, Borough > 10000)

df <-
  calls %>%
  mutate(Date = as.Date(`Created Date`, format = "%m/%d/%Y"),
         Year = format(Date, "%y")) %>%
  filter(Descriptor == "Rat Sighting",
         Year != 01/22, Year >= 01/14) %>%
  select( BBL, Borough, `Incident Zip`, Year) %>%
  na.omit() %>%
  group_by(BBL, Borough, `Incident Zip`, Year) %>%
  summarize(count = n()) %>% 
  filter(BBL != 0, Borough > 10000)

```

```{r}


```

```{r}
lots_year_1 <- df %>% filter(Year == "14") %>% pull(BBL)
lots_year_2 <- df %>% filter(Year == "15") %>% pull(BBL)
number_in_year_1 <- length(lots_year_1)
number_in_year_2 <- length(lots_year_2)
number_in_year_1_and_2 <- sum(lots_year_1 %in% lots_year_2)
  
number_in_year_1 * number_in_year_2 / number_in_year_1_and_2
```

```{r}
50 * number_in_year_1 * number_in_year_2 / number_in_year_1_and_2
```

```{r}
capture_recapture <- function(year) {
  lots_year_1 <- df %>% filter(Year == year - 1) %>% pull(BBL)
  lots_year_2 <- df %>% filter(Year == year) %>% pull(BBL)
  number_in_year_1 <- length(lots_year_1)
  number_in_year_2 <- length(lots_year_2)
  number_in_year_1_and_2 <- sum(lots_year_1 %in% lots_year_2)
  50 * number_in_year_1 * number_in_year_2 / number_in_year_1_and_2
}
```

```{r}
qplot(x = factor(2015:2021),
      weight = sapply(15:21, capture_recapture),
      geom = "bar")  +
  labs(x = "year",
       y = "estimated rat population") +
  theme_bw()
```

```{r calls}
library(ggplot2)
ggplot(df, aes(fill= Borough, y = count , x = Year)) +
  geom_bar(position = "stack", stat = "identity") 
```

```{r replicating capture recapture but for datafram not just an integer}
lots_year_18 <- df %>% filter(Year == "18") %>% select(BBL, Borough, `Incident Zip`)
lots_year_19 <- df %>% filter(Year == "19") %>% select(BBL, Borough, `Incident Zip`)

common_lots_18_19 <- inner_join(lots_year_18, lots_year_19)
```

```
