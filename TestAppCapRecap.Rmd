---
title: "TestAppCapRecap"
author: "Chris"
date: '2022-06-20'
output: html_document
---

```{r}
library("tidyverse")
library(dplyr)
```

```{r}
calls <- read_csv("nyc_rodent_compliants.csv")
rename(calls, Incident_Zip = "Incident Zip")
```

```{r}
df <-
  calls %>%
  mutate(Date = as.Date(`Created Date`, format = "%m/%d/%Y"),
         Year = format(Date, "%y")) %>%
  filter(Descriptor == "Rat Sighting",
         Year != 22, Year >= 14) %>%
  select(Year, BBL, Borough) %>%
  na.omit() %>%
  group_by(BBL, Year, Borough, Incident_Zip) %>%
  summarize(count = n()) %>% 
  filter(BBL != 0, Borough > 10000)
```

```{r}
lots_year_1 <- df %>% filter(Year == "14") %>% pull(BBL)
lots_year_2 <- df %>% filter(Year == "15") %>% pull(BBL)
number_in_year_1 <- length(lots_year_1)
number_in_year_2 <- length(lots_year_2)
number_in_year_1_and_2 <- sum(lots_year_1 %in% lots_year_2)
  
number_in_year_1 * number_in_year_2 / number_in_year_1_and_2
```

```{r}
50 * number_in_year_1 * number_in_year_2 / number_in_year_1_and_2
```

```{r}
capture_recapture <- function(year) {
  lots_year_1 <- df %>% filter(Year == year - 1) %>% pull(BBL)
  lots_year_2 <- df %>% filter(Year == year) %>% pull(BBL)
  number_in_year_1 <- length(lots_year_1)
  number_in_year_2 <- length(lots_year_2)
  number_in_year_1_and_2 <- sum(lots_year_1 %in% lots_year_2)
  50 * number_in_year_1 * number_in_year_2 / number_in_year_1_and_2
}
```

```{r}
qplot(x = factor(2015:2021),
      weight = sapply(15:21, capture_recapture),
      geom = "bar")  +
  labs(x = "year",
       y = "estimated rat population") +
  theme_bw()
```

```{r calls}
library(ggplot2)
ggplot(df, aes(fill= Borough, y = count , x = Year)) +
  geom_bar(position = "stack", stat = "identity") 
```
```{r}
lots_year_18 <- df %>% filter(Year == "18") %>% select(BBL, Year, Borough, `Incident Zip`)
lots_year_19 <- df %>% filter(Year == "19") %>% select(BBL, Year, Borough, `Incident Zip`)
number_in_year_18 <- length(lots_year_18)
number_in_year_19 <- length(lots_year_19)
number_in_year_18_and_19 <- sum(lots_year_18 %in% lots_year_19)
  
number_in_year_18 * number_in_year_19 / number_in_year_18_and_19
```
